<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Your Friendship Result üíñ</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Poppins',sans-serif}
body{
  min-height:100vh;
  background:radial-gradient(circle at top,#3a004d,#000);
  color:#fff;
  display:flex;
  justify-content:center;
  align-items:center;
  overflow:hidden;
}
.card{
  max-width:520px;width:92%;
  background:rgba(255,255,255,.08);
  padding:26px 20px;border-radius:26px;
  text-align:center;
  box-shadow:0 0 45px rgba(255,95,191,.5);
}
h1{color:#ff5fbf;text-shadow:0 0 18px #ff5fbf}
.bigHeart{font-size:80px;animation:beat 1.2s infinite;margin:10px 0}
@keyframes beat{0%{transform:scale(1)}50%{transform:scale(1.25)}100%{transform:scale(1)}}
.score{font-size:20px;margin-top:6px}
.score span{color:#ff5fbf;font-weight:700}
.percent{font-size:44px;margin:10px 0 14px;font-weight:700;text-shadow:0 0 15px #ff5fbf}
.quote{font-size:18px;color:#ffdfff;margin-bottom:20px;text-shadow:0 0 18px rgba(255,95,191,.6)}
.buttons{display:flex;gap:14px;justify-content:center}
button{padding:10px 22px;border-radius:24px;font-weight:600;border:none;cursor:pointer}
.play{background:#ff5fbf;color:#000}
.home{background:transparent;border:2px solid #ff5fbf;color:#ff5fbf}
.home:hover{background:#ff5fbf;color:#000}
.heart{position:fixed;bottom:-30px;font-size:22px;color:#ff5fbf;animation:floatUp linear infinite;opacity:.9}
@keyframes floatUp{from{transform:translateY(0);opacity:1}to{transform:translateY(-120vh);opacity:0}}
.nameLine{font-size:18px;margin-bottom:6px}
</style>
</head>

<body>

<div class="card">

  <h1 id="title">Your Friendship Result üíñ</h1>

  <div class="bigHeart">‚ù§Ô∏è</div>

  <div class="nameLine" id="names">Loading...</div>

  <div class="score">
    Score : <span id="score">0</span> / 10
  </div>

  <div class="percent" id="percent">0%</div>

  <div class="quote" id="quote">Loading...</div>

  <div class="buttons">
    <button class="play" onclick="playAgain()">Play Again</button>
    <button class="home" onclick="goHome()">Home</button>
  </div>

</div>

<script type="module">

/* ---------------- FIREBASE ---------------- */
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getDatabase, ref, get, update } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyAe03MrWOoAWAXgqjtEsb47Aq4obBXWaRY",
  authDomain: "auraa-love-game.firebaseapp.com",
  databaseURL: "https://auraa-love-game-default-rtdb.firebaseio.com",
  projectId: "auraa-love-game",
  storageBucket: "auraa-love-game.firebasestorage.app",
  messagingSenderId: "631139663700",
  appId: "1:631139663700:web:19acff37da1aba02fc12c1"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

/* -------------- LOCAL DATA ---------------- */
const ROOM = localStorage.getItem("roomCode") || "";
const ME = localStorage.getItem("player") || "";   // "p1" OR "p2"

/* ---------------- HEART BG ---------------- */
for(let i=0;i<25;i++){
 let h=document.createElement("div");
 h.className="heart";
 h.innerHTML="‚ù§";
 h.style.left=Math.random()*100+"vw";
 h.style.animationDuration=4+Math.random()*6+"s";
 document.body.appendChild(h);
}

/* ----------- QUOTES ----------- */
const quotes=[
"Vibes speak louder than words ü§ô‚ú®",
"Soul clicks ‚Äî not just pics üíõ",
"Besties are pure magic üéâ",
"We don‚Äôt talk ‚Äî we connect üí´",
"Chaos turns to glitter ‚ú®",
"Heart talks louder üíå",
"Friendship is the real flex üòé",
"We glow together üåü",
"Soul friends exist üíñ",
"Even silence speaks üåà"
];

/* ---------- LOAD SCORES ---------- */
async function loadResult(){

   if(!ROOM){
      alert("Room missing!");
      return;
   }

   const snap = await get(ref(db, "rooms/"+ROOM));

   if(!snap.exists()){
      alert("Room not found!");
      return;
   }

   const data = snap.val();

   const n1 = data.p1?.name || "Player 1";
   const n2 = data.p2?.name || "Player 2";

   document.getElementById("names").innerText =
    n1 + " ‚ù§Ô∏è " + n2;

   document.getElementById("title").innerText =
    n1 + " & " + n2 + " Friendship Bond üíñ";

   const s1 = data.p1?.score || 0;
   const s2 = data.p2?.score || 0;

   const total = 10;
   const matchScore = Math.min(s1,s2); // OR your match logic

   const percent = Math.round((matchScore/total)*100);

   document.getElementById("score").innerText = matchScore;
   document.getElementById("percent").innerText = percent + "%";
   document.getElementById("quote").innerText =
      quotes[Math.floor(Math.random()*quotes.length)];

   // mark finished
   await update(ref(db,"rooms/"+ROOM+"/"+ME),{ finished:true });
}

loadResult();

/* ---------- BUTTONS ---------- */
window.playAgain = function(){
   localStorage.clear();
   window.location.href = "lobby.html";
}
window.goHome = function(){
   localStorage.clear();
   window.location.href = "index.html";
}

</script>

</body>
</html>
